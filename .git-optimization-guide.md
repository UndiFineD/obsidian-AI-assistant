# Git Repository Optimization Guide

## Last Optimization Run
- **Date**: October 21, 2025
- **Initial Size**: 23.83 MB
- **Final Size**: 19.94 MB
- **Space Saved**: 3.89 MB (16.3% reduction)
- **Method**: Aggressive garbage collection with delta compression

## Quick Optimization (Run This Periodically)

### One-Line Command
```powershell
git gc --aggressive --prune=now
```

**Time**: ~2-5 seconds  
**Safety**: Safe - doesn't affect working directory or active branches  
**Result**: Typically saves 5-20% depending on repository activity

## Advanced Optimizations

### Option 1: Deep Cleanup (Reflog Expiration)
```powershell
git reflog expire --expire=now --all
git gc --aggressive --prune=now
```

**Time**: ~5-10 seconds  
**Safety**: Very safe - only removes dangling references  
**Result**: Additional 5-10% reduction if significant history exists

### Option 2: Repack With Delta Compression
```powershell
git repack -Ad
```

**Purpose**: More aggressive delta compression  
**Time**: ~10-30 seconds  
**Result**: Can reduce size by 10-30% for large repositories

### Option 3: Full Maintenance (All Options)
```powershell
git reflog expire --expire=now --all
git repack -Ad
git gc --aggressive --prune=now
```

**Safety**: Very safe - comprehensive optimization  
**Result**: Maximum compression without code loss

## Repository Statistics

### Current Stats
```
Total objects: 5,454
Packed objects: 10,720
Pack files: 1
Total pack size: ~17 MB
```

### Check Stats Anytime
```powershell
git count-objects -v
```

## What Gets Optimized

✅ **Compressed**: Redundant object data, delta chains  
✅ **Consolidated**: Multiple pack files merged into one  
✅ **Cleaned**: Unreferenced objects and garbage  
✅ **Repacked**: Objects reorganized for compression  

❌ **NOT Affected**: Branches, commits, history, working directory

## Safety Notes

- ✓ All optimizations are **non-destructive**
- ✓ Active branches and commits are **always safe**
- ✓ Can be run **while working** (may cause brief pauses)
- ✓ Can be run **multiple times** without issues
- ✓ Results are **transparent** to Git workflow

## When to Optimize

1. **After large commits** - newly added large files compress well
2. **After merges/rebases** - creates opportunities for delta compression
3. **Periodically** - weekly or monthly for active repositories
4. **Before archiving** - minimize size for backups
5. **Before pushing** - reduces server load and bandwidth

## If You Need Maximum Space Reduction

### Shallow Clone (Advanced - Fresh Start)
```powershell
# Creates new clone with only recent history
git clone --depth 1 https://github.com/UndiFineD/obsidian-AI-assistant.git new-repo
# Then remove old repo and rename new-repo

# Reduces size from 20+ MB to 5-10 MB
# Trade-off: Lose full history
```

## Troubleshooting

| Issue | Solution |
|-------|----------|
| `git gc` takes too long | Run with `--aggressive` for better results; can interrupt and re-run |
| Size not reducing | Multiple `gc` runs sometimes needed; try `repack -Ad` first |
| Out of disk space | Ensure free space = current .git size × 2 |
| Performance slowdown | Normal during gc; usually resolves quickly |

## Tips for Keeping Repository Lean

1. **Use `.gitignore`** - Prevent large files from being tracked
2. **Clean local branches** - `git branch -d <branch>`
3. **Remove large files from history** - Use `git filter-branch` or `BFG` (advanced)
4. **Archive old branches** - Move to separate repo
5. **Use git LFS** - For binary files (images, videos, archives)

## Recommended Maintenance Schedule

- **Weekly**: `git gc --aggressive` (if actively committing)
- **Monthly**: `git reflog expire --expire=now --all && git gc --aggressive --prune=now`
- **Quarterly**: Full deep cleanup with repack

## For Repository Maintainers

Consider running in CI/CD pipeline:
```yaml
- name: Git Optimization
  run: |
    git reflog expire --expire=now --all
    git gc --aggressive --prune=now
  # Schedule: Monthly or quarterly
```

---

*Created: October 21, 2025*  
*Repository: obsidian-AI-assistant*  
*Version: 0.1.30*
